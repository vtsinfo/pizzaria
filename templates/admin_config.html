{% extends "base_admin.html" %}

{% block title %}Configurações - Admin Colonial{% endblock %}

{% block content %}
<div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="m-0 fw-bold"><i class="fas fa-sliders-h text-warning"></i> Configurações do Sistema</h4>
        <a href="/admin/dashboard" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    </div>

    <form method="POST" action="{{ url_for('admin.admin_config') }}" enctype="multipart/form-data">
        <div class="row g-4">
            <!-- COLUNA ESQUERDA -->
            <div class="col-lg-6">
                <!-- MÓDULOS -->
                <div class="card shadow-sm border-secondary mb-4">
                    <div class="card-header border-secondary bg-body-tertiary py-3">
                        <h5 class="mb-0 text-white"><i class="fas fa-puzzle-piece text-info"></i> Módulos e
                            Funcionalidades</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3 p-3 rounded bg-dark border border-secondary">
                            <input class="form-check-input" type="checkbox" id="inventory_enabled"
                                name="inventory_enabled" {% if config.get('inventory_enabled') %}checked{% endif %}>
                            <label class="form-check-label w-100" for="inventory_enabled">
                                <strong class="text-white">Controle de Estoque (ERP)</strong><br>
                                <small class="text-secondary">Habilita menu de ingredientes e baixa automática.</small>
                            </label>

                            <div class="mt-2 ms-4 pt-2 border-top border-secondary">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="allow_negative_stock"
                                        name="allow_negative_stock" {% if config.get('allow_negative_stock') %}checked{%
                                        endif %}>
                                    <label class="form-check-label text-secondary" for="allow_negative_stock">
                                        Permitir Estoque Negativo
                                    </label>
                                </div>
                            </div>
                        </div>

                        <h6 class="text-muted text-uppercase small fw-bold mt-4 mb-3">Modos de Operação</h6>

                        <div class="d-flex flex-column gap-2">
                            <div class="form-check form-switch p-2 rounded hover-bg">
                                <input class="form-check-input" type="checkbox" id="ai_enabled" name="ai_enabled" {% if
                                    config.get('ai_enabled') %}checked{% endif %}>
                                <label class="form-check-label" for="ai_enabled">Assistente IA (Chat)</label>
                            </div>

                            <div class="form-check form-switch p-2 rounded hover-bg">
                                <input class="form-check-input" type="checkbox" id="self_service_enabled"
                                    name="self_service_enabled" {% if config.get('self_service_enabled') %}checked{%
                                    endif %}>
                                <label class="form-check-label" for="self_service_enabled">Modo Self-Service
                                    (Almoço)</label>
                            </div>

                            <div class="form-check form-switch p-2 rounded hover-bg">
                                <input class="form-check-input" type="checkbox" id="rodizio_pizza_enabled"
                                    name="rodizio_pizza_enabled" {% if config.get('rodizio_pizza_enabled') %}checked{%
                                    endif %}>
                                <label class="form-check-label" for="rodizio_pizza_enabled">Rodízio de Pizzas</label>
                            </div>

                            <div class="form-check form-switch p-2 rounded hover-bg">
                                <input class="form-check-input" type="checkbox" id="rodizio_carne_enabled"
                                    name="rodizio_carne_enabled" {% if config.get('rodizio_carne_enabled') %}checked{%
                                    endif %}>
                                <label class="form-check-label" for="rodizio_carne_enabled">Rodízio de Carnes</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CARDÁPIO / EXIBIÇÃO (Moved to Left Column to balance height) -->
                <div class="card shadow-sm border-secondary">
                    <div class="card-header border-secondary bg-body-tertiary py-3">
                        <h5 class="mb-0 text-white"><i class="fas fa-list text-warning"></i> Exibição do Cardápio</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="alert alert-dark m-3 border-secondary small">
                            <i class="fas fa-info-circle"></i> Controle aqui o que aparece no site para o cliente.
                        </div>
                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-dark table-hover mb-0 align-middle">
                                <thead style="position: sticky; top: 0; background-color: #2c3034; z-index: 1;">
                                    <tr>
                                        <th class="ps-3">Categoria</th>
                                        <th class="text-center" width="20%">Visível</th>
                                        <th class="text-center" width="20%">Preço</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for cat in categorias %}
                                    <tr>
                                        <td class="ps-3 fw-bold">{{ cat.nome }}</td>
                                        <td class="text-center">
                                            <div class="form-check form-switch d-flex justify-content-center">
                                                <input class="form-check-input fs-5" type="checkbox"
                                                    id="cat_vis_{{ cat.id }}" name="cat_visible_{{ cat.id }}" {% if
                                                    cat.visivel %}checked{% endif %}>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="form-check form-switch d-flex justify-content-center">
                                                <input class="form-check-input fs-5" type="checkbox"
                                                    id="cat_price_{{ cat.id }}" name="cat_price_{{ cat.id }}" {% if
                                                    cat.exibir_preco %}checked{% endif %}>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer border-secondary bg-body-tertiary text-center text-muted small">
                        Salve para aplicar as alterações.
                    </div>
                </div>
            </div>

            <!-- COLUNA DIREITA -->
            <div class="col-lg-6">
                <!-- GERAL -->
                <div class="card shadow-sm border-secondary h-100">
                    <div class="card-header border-secondary bg-body-tertiary py-3">
                        <h5 class="mb-0 text-white"><i class="fas fa-store text-success"></i> Informações da Loja</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label text-secondary small text-uppercase fw-bold">História (Sobre
                                    Nós)</label>
                                <textarea class="form-control bg-dark text-light border-secondary" name="sobre_nos"
                                    rows="4"
                                    placeholder="Conte a história da pizzaria...">{{ config.get('sobre_nos', '') }}</textarea>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Tempo de
                                    Espera</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-dark border-secondary text-secondary"><i
                                            class="far fa-clock"></i></span>
                                    <input type="text" class="form-control bg-dark text-light border-secondary"
                                        name="tempo_espera" value="{{ config.get('tempo_espera', '') }}"
                                        placeholder="Ex: 40-50 min">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Cor
                                    Principal</label>
                                <div class="d-flex gap-2">
                                    <input type="color" class="form-control form-control-color bg-dark border-secondary"
                                        name="cor_primaria" value="{{ config.get('cor_primaria', '#ffc107') }}"
                                        title="Escolha a cor principal">
                                    <input type="text" class="form-control bg-dark text-light border-secondary"
                                        value="{{ config.get('cor_primaria', '#ffc107') }}" readonly>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Telefone</label>
                                <input type="text" class="form-control bg-dark text-light border-secondary"
                                    name="telefone" value="{{ config.get('telefone', '') }}">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label text-secondary small text-uppercase fw-bold">WhatsApp</label>
                                <input type="text" class="form-control bg-dark text-light border-secondary"
                                    name="whatsapp" value="{{ config.get('whatsapp', '') }}">
                            </div>

                            <div class="col-12">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Endereço
                                    Principal</label>
                                <input type="text" class="form-control bg-dark text-light border-secondary"
                                    name="endereco_principal" value="{{ config.get('endereco_principal', '') }}">
                            </div>

                            <div class="col-12">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Destaque do
                                    Forno</label>
                                <input type="text" class="form-control bg-dark text-light border-secondary"
                                    name="tipo_forno" value="{{ config.get('tipo_forno', '') }}"
                                    placeholder="Ex: Forno a Lenha">
                            </div>

                            <div class="col-12">
                                <label class="form-label text-secondary small text-uppercase fw-bold">Logotipo
                                    Atual</label>
                                <div
                                    class="d-flex align-items-center gap-3 p-3 border border-secondary rounded bg-dark">
                                    {% if config.get('logo_url') %}
                                    <img src="{{ config.get('logo_url') }}" alt="Logo" class="img-fluid rounded"
                                        style="max-height: 60px;">
                                    {% else %}
                                    <span class="text-muted fst-italic">Sem logo</span>
                                    {% endif %}
                                    <div class="flex-grow-1">
                                        <input type="file" class="form-control bg-dark text-light border-secondary"
                                            name="logo" accept="image/*">
                                        <div class="form-text text-muted">Recomendado: PNG transparente.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="position-fixed bottom-0 end-0 p-4" style="z-index: 100;">
            <button type="submit" class="btn btn-success btn-lg shadow-lg rounded-pill px-5 fw-bold">
                <i class="fas fa-check-circle me-2"></i> Salvar Alterações
            </button>
        </div>
    </form>
</div>
{% endblock %}