{% extends "base_admin.html" %}

{% block title %}Configurações - Admin Colonial{% endblock %}

{% block content %}
<div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="m-0 fw-bold text-white"><i class="fas fa-cogs text-secondary"></i> Configurações do Sistema</h4>
            <p class="text-secondary small m-0">Gerencie módulos, IA e exibição do cardápio.</p>
        </div>
        <a href="/admin/dashboard" class="btn btn-outline-dark">
            <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    </div>

    <!-- Alerta de Migração (Discreto) -->
    <div class="alert alert-dark border-secondary d-flex align-items-center mb-4" role="alert">
        <i class="fas fa-info-circle text-info fs-4 me-3"></i>
        <div>
            <h6 class="alert-heading m-0 fw-bold">Onde estão os dados da loja?</h6>
            <p class="mb-0 small text-muted">Endereço, telefone e horários agora ficam em <a href="/admin/empresa"
                    class="text-info text-decoration-none fw-bold">Dados da Empresa</a>.</p>
        </div>
        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="alert"
            aria-label="Close"></button>
    </div>

    <form method="POST" action="{{ url_for('admin.admin_config') }}" enctype="multipart/form-data">
        <div class="row g-4">

            <!-- COLUNA ESQUERDA: MÓDULOS E IA -->
            <div class="col-lg-5">

                <!-- Módulos Globais -->
                <div class="card shadow-lg border-0 mb-4 bg-dark-subtle">
                    <div class="card-header bg-transparent border-secondary py-3">
                        <h5 class="mb-0 text-white"><i class="fas fa-puzzle-piece text-warning"></i> Funcionalidades
                        </h5>
                    </div>
                    <div class="card-body bg-dark rounded-bottom p-0">
                        <div class="list-group list-group-flush border-secondary">

                            <!-- ERP -->
                            <div class="list-group-item bg-dark border-secondary p-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input fs-5" type="checkbox" id="inventory_enabled"
                                        name="inventory_enabled" {% if config.get('inventory_enabled') %}checked{% endif
                                        %}>
                                    <label class="form-check-label w-100 ps-2" for="inventory_enabled">
                                        <span class="d-block fw-bold text-white">Controle de Estoque (ERP)</span>
                                        <span class="d-block small text-secondary">Habilita menu de ingredientes e baixa
                                            automática.</span>
                                    </label>
                                </div>
                                <div class="ms-5 mt-2 ps-2 border-start border-secondary">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="allow_negative_stock"
                                            name="allow_negative_stock" {% if config.get('allow_negative_stock')
                                            %}checked{% endif %}>
                                        <label class="form-check-label text-secondary small"
                                            for="allow_negative_stock">Permitir estoque negativo</label>
                                    </div>
                                </div>
                            </div>

                            <!-- IA Assistant -->
                            <div class="list-group-item bg-dark border-secondary p-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input fs-5" type="checkbox" id="ai_enabled"
                                        name="ai_enabled" {% if config.get('ai_enabled') %}checked{% endif %}>
                                    <label class="form-check-label w-100 ps-2" for="ai_enabled">
                                        <span class="d-block fw-bold text-white">Assistente de IA</span>
                                        <span class="d-block small text-secondary">Chatbot "Val" para atendimento
                                            automático.</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Outros Módulos -->
                            <div class="list-group-item bg-dark border-secondary p-3">
                                <h6 class="text-uppercase text-muted small fw-bold mb-3">Modos de Operação</h6>

                                <div class="d-flex flex-column gap-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="self_service_enabled"
                                            name="self_service_enabled" {% if config.get('self_service_enabled')
                                            %}checked{% endif %}>
                                        <label class="form-check-label text-white"
                                            for="self_service_enabled">Self-Service (Almoço)</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="rodizio_pizza_enabled"
                                            name="rodizio_pizza_enabled" {% if config.get('rodizio_pizza_enabled')
                                            %}checked{% endif %}>
                                        <label class="form-check-label text-white" for="rodizio_pizza_enabled">Rodízio
                                            de Pizzas</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="rodizio_carne_enabled"
                                            name="rodizio_carne_enabled" {% if config.get('rodizio_carne_enabled')
                                            %}checked{% endif %}>
                                        <label class="form-check-label text-white" for="rodizio_carne_enabled">Rodízio
                                            de Carnes</label>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Personalização IA -->
                <div class="card shadow-lg border-0 bg-dark-subtle">
                    <div class="card-header bg-transparent border-secondary py-3">
                        <h5 class="mb-0 text-white"><i class="fas fa-robot text-info"></i> Personalização da IA</h5>
                    </div>
                    <div class="card-body bg-dark rounded-bottom">
                        <div class="mb-3">
                            <label class="form-label text-secondary small text-uppercase">Nome da Assistente</label>
                            <input type="text" class="form-control bg-black text-light border-secondary" name="ai_name"
                                value="{{ config.get('ai_name', 'Val') }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-secondary small text-uppercase">Voz (Text-to-Speech)</label>
                            <select class="form-select bg-black text-light border-secondary" name="voice_gender">
                                <option value="female" {% if config.get('voice_gender')=='female' %}selected{% endif %}>
                                    Feminina (Padrão)</option>
                                <option value="male" {% if config.get('voice_gender')=='male' %}selected{% endif %}>
                                    Masculina</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>

            <!-- COLUNA DIREITA: CARDÁPIO -->
            <div class="col-lg-7">
                <div class="card shadow-lg border-0 h-100 bg-dark-subtle">
                    <div
                        class="card-header bg-transparent border-secondary py-3 d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0 text-white"><i class="fas fa-list text-success"></i> Exibição do Cardápio
                            </h5>
                            <p class="m-0 small text-secondary">Controle o que aparece no site.</p>
                        </div>
                        <span class="badge bg-dark border border-secondary text-secondary">Live Preview</span>
                    </div>
                    <div class="card-body bg-dark rounded-bottom p-0">
                        <div class="table-responsive h-100">
                            <table class="table table-dark table-hover mb-0 align-middle">
                                <thead class="table-group-divider bg-black">
                                    <tr>
                                        <th class="ps-4 py-3 text-secondary text-uppercase small">Categoria</th>
                                        <th class="text-center text-secondary text-uppercase small">Visível no Site</th>
                                        <th class="text-center text-secondary text-uppercase small pe-4">Mostrar Preço
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for cat in categorias %}
                                    <tr>
                                        <td class="ps-4 fw-bold text-white">{{ cat.nome }}</td>
                                        <td class="text-center">
                                            <div class="form-check form-switch d-inline-block">
                                                <input class="form-check-input fs-5 cursor-pointer" type="checkbox"
                                                    id="cat_vis_{{ cat.id }}" name="cat_visible_{{ cat.id }}" {% if
                                                    cat.visivel %}checked{% endif %}>
                                            </div>
                                        </td>
                                        <td class="text-center pe-4">
                                            <div class="form-check form-switch d-inline-block">
                                                <input class="form-check-input fs-5 cursor-pointer" type="checkbox"
                                                    id="cat_price_{{ cat.id }}" name="cat_price_{{ cat.id }}" {% if
                                                    cat.exibir_preco %}checked{% endif %}>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="position-fixed bottom-0 end-0 p-4" style="z-index: 100;">
            <button type="submit" class="btn btn-warning btn-lg shadow-lg rounded-pill px-5 fw-bold text-dark">
                <i class="fas fa-save me-2"></i> Salvar Preferências
            </button>
        </div>
    </form>
</div>
{% endblock %}